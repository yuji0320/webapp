# 外部設計 (バックエンド)

本外部設計書には業務システム全体の基幹機能を構成する本体APIに関する設計のみを行う。

画面設計等はフロントエンド設計を参照のこと

## 目次

- アーキテクチャ設計

  - プラットフォーム設計

    - アーキテクチャ図
    - 本体API環境
    - その他プログラム
    - 使用ライブラリ

  - アプリケーション・アーキテクチャ設計

    - 機能構成

  - 開発標準

- アプリケーション設計

  - API構成

## アーキテクチャ設計

本項ではシステムのプラットフォーム設計、アプリケーション・アーキテクチャ設計、開発標準について記述する。

運用アーキテクチャ構成 大元の運用サーバーはWindows server 2016となるが、他環境での運用の場合はOSが変更になる場合がるため仮想環境での構築、運用を行う。

### プラットフォーム設計

#### アーキテクチャ図

[](TODOアーキテクチャ図の作成)

#### 本体API環境

項目  | 使用環境 | バージョン
:-- | :--- | :----
    |      |
--- |

言語 | python3 | 3.6 データベース | MySQL | 5.6 Webサーバー|nginx | 1.11.1-1~jessie フレームワーク | Django | 2.0.5

#### 使用ライブラリ

項目               | 使用環境                    | バージョン
:--------------- | :---------------------- | :-----
データベース連携         | PyMySQL                 | 0.8.1
REST API フレームワーク | Django rest framework   | 3.8.2
ログイン認証ライブラリ      | Djangorestframework-jwt | 1.11.0

### アプリケーション・アーキテクチャ設計

本項ではアプリケーション全体の構成を記述する。

#### アプリケーション機能構成

アプリケーションに置ける機能の構成について定義する。 

内容を大きく管理系と機能系に分けてリストアップする。

##### 管理系一覧

No   | 機能名          | RDD機能番号 | 機能詳細
:--- | :----------- | :------ | :-------------
M001 | システムマスタ管理    |         | システム基幹マスタの管理
M002 | 会社情報管理機能     | F006-1  | 会社情報の管理機能
M003 | ログインユーザー管理機能 | C003    | ログインユーザーの管理機能

##### 機能系一覧

No   | 機能名     | RDD機能番号 | 機能詳細
:--- | :------ | :------ | :---------------
F001 | 作業指図書管理 | F001    | 作業指図書登録、詳細、編集、削除
F002 | 部品表管理機能 | F002    | 部品表登録、詳細、編集、削除
F003 | 発注管理機能  | F003    | 発注関係の機能
F004 | 仕入管理機能  | F004    | 仕入関係の機能
F005 | 調査関係    | F005    | 調査関係の機能
F006 | マスタ関係   | F006    | マスタ関係の管理機能

### 開発標準

#### API命名規則

Django REST Frameworkの仕様に準拠する。

## アプリケーション設計

APIの構成や出力形式等を記載する。

### M001 システムマスタ管理

システム基幹マスタ情報を管理する部分であり、基本的にシステム管理者のみが操作する項目。 これらのマスタ情報の構成はユーザー毎に統一したものであると想定し、ユーザー毎のデータ保持は行わない。

API項目としては

- 国マスタ
- 通貨マスタ
- 単位マスタ である。

#### 国マスタ

ユーザー企業の所在国情報を司る部分であり、現時点では国名及び国コード(ISO 3166-1 alpha-2準拠)のみであるが、 将来的には税務的な情報等もここに追加する予定である。

##### 国マスタAPI出力

```json
[
    {
        "id": 1,
        "name": "Japan",
        "code": "JP",
        "created_at": "2018-09-01T12:00:00",
        "modified_at": "2018-09-01T12:00:00"
    },
    {
        "id": 2,
        "name": "United States of America",
        "code": "US",
        "created_at": "2018-09-01T12:00:00",
        "modified_at": "2018-09-01T12:00:00"
    }
]
```

#### 通貨マスタ

ユーザーが使用する通貨情報のマスタ部分であり、 各ユーザー企業は基軸通貨を設定し、それを基準として他の通貨のレートを保持することとする。

それに伴う通貨種別を記録するためのマスタデータをシステム上で保持する。

##### 通貨マスタAPI出力

```json
[
    {
        "id": 1,
        "name": "Japanese yen",
        "code": "JPY",
        "display": "¥",
        "decimal_point": 0,
        "created_at": "2018-09-01T12:00:00",
        "modified_at": "2018-09-01T12:00:00"
    },
    {
        "id": 2,
        "name": "United States Dollar",
        "code": "USD",
        "display": "$",
        "decimal_point": 2,
        "created_at": "2018-09-01T12:00:00",
        "modified_at": "2018-09-01T12:00:00"
    }
]
```

#### 単位マスタ

資材管理を行う際に記録単位や発注単位をシステム上のマスタとして登録し、データ整合性を保持する。

##### 単位マスタAPI出力

```json
[
    {
        "id": 1,
        "name": "quantity",
        "display": "qty",
        "created_at": "2018-09-01T12:00:00",
        "modified_at": "2018-09-01T12:00:00"
    }
]
```

### M002 会社情報管理機能
